---
import { Icon } from "astro-icon/components";
import Image from "astro/components/Image.astro";
import ApplyModal from "~/components/apply-modal.astro";
import BottomNav from "~/components/bottom-nav.astro";
import type { NavItem } from "~/types";

const navItems: Array<NavItem> = [
  { title: "talents", url: "#talents" },
  { title: "about us", url: "#aboutus" },
  { title: "team", url: "#team" },
  { title: "contact", url: "#contact" },
];
---

<header
  id="page-header"
  class="fixed top-0 left-0 right-0 z-20 flex w-full items-center justify-between px-6 sm:px-10 lg:px-16 py-6"
>
  <a class="flex items-center hover:opacity-80 transition-opacity flex-shrink-0" href="#">
    <h1 class="sr-only">Unides</h1>
    <Image src="/unides_yellow.png" alt="Unides Logo" class="header-logo-yellow h-6 sm:h-8 w-auto" width={200} height={50}/>
    <Image src="/unides_green.png" alt="Unides Logo" class="header-logo-green h-6 sm:h-8 w-auto hidden" width={200} height={50}/>
    <Image src="/unides_pink.png" alt="Unides Logo" class="header-logo-pink h-6 sm:h-8 w-auto hidden" width={200} height={50}/>
  </a>
  
  <!-- Desktop Navigation -->
  <nav class="desktop-nav">
    <ul class="flex items-center gap-6 lg:gap-10">
      {
        navItems.map(({ title, url }) => (
          <li>
            <a class="nav-link-new" href={url}>
              {title}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>

</header>

<!-- Apply Modal -->
<ApplyModal />

<!-- Bottom Navigation for Mobile -->
<BottomNav />

<script>
  const header = document.getElementById('page-header');
  const page = document.documentElement;

  // Handle scroll for fixed header and section detection
  if (header) {
    document.addEventListener('scroll', () => {
      const talentsSection = document.getElementById('talents');
      const headerHeight = header.offsetHeight;
      const scrollY = window.scrollY;
      
      // Become fixed when reaching talents section title
      let isFixed = false;
      if (talentsSection) {
        isFixed = scrollY >= talentsSection.offsetTop - headerHeight - 20;
      }
      
      header.classList.toggle('fixed-header', isFixed);
      
      if (isFixed) {
        // Detect which section is currently in view
        const aboutSection = document.getElementById('aboutus');
        const contactSection = document.getElementById('contact');
        
        let onAboutSection = false;
        let onContactSection = false;
        
        if (aboutSection) {
          const aboutTop = aboutSection.offsetTop - headerHeight - 50;
          const aboutBottom = aboutTop + aboutSection.offsetHeight;
          onAboutSection = scrollY >= aboutTop && scrollY < aboutBottom;
        }
        
        if (contactSection) {
          const contactTop = contactSection.offsetTop - headerHeight - 50;
          const contactBottom = contactTop + contactSection.offsetHeight;
          onContactSection = scrollY >= contactTop && scrollY < contactBottom;
        }
        
        header.classList.toggle('on-about-section', onAboutSection);
        header.classList.toggle('on-contact-section', onContactSection);

        // Toggle logo visibility based on section
        const yellowLogo = header.querySelector('.header-logo-yellow');
        const greenLogo = header.querySelector('.header-logo-green');
        const pinkLogo = header.querySelector('.header-logo-pink');

        if (yellowLogo && greenLogo && pinkLogo) {
          // Hide all logos first
          yellowLogo.classList.add('hidden');
          greenLogo.classList.add('hidden');
          pinkLogo.classList.add('hidden');

          // Show appropriate logo
          if (onContactSection) {
            pinkLogo.classList.remove('hidden');
          } else if (onAboutSection) {
            yellowLogo.classList.remove('hidden');
          } else {
            greenLogo.classList.remove('hidden');
          }
        }
      } else {
        header.classList.remove('on-about-section');
        header.classList.remove('on-contact-section');

        // Show yellow logo when not fixed
        const yellowLogo = header.querySelector('.header-logo-yellow');
        const greenLogo = header.querySelector('.header-logo-green');
        const pinkLogo = header.querySelector('.header-logo-pink');

        if (yellowLogo && greenLogo && pinkLogo) {
          yellowLogo.classList.remove('hidden');
          greenLogo.classList.add('hidden');
          pinkLogo.classList.add('hidden');
        }
      }
    });
  }
</script>

<style>
  .fixed-header {
    @apply fixed bottom-auto top-0;
    background: white;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }
  
  .fixed-header .nav-link-new {
    color: #A987FF !important;
  }
  
  .fixed-header .nav-link-new:hover {
    text-decoration-color: #A987FF !important;
  }
  
  /* On about us section - lime/green background with orange text */
  .fixed-header.on-about-section {
    background: #D9FD12 !important;
  }
  
  .fixed-header.on-about-section .nav-link-new {
    color: #F26522 !important;
  }
  
  .fixed-header.on-about-section .nav-link-new:hover {
    text-decoration-color: #F26522 !important;
  }
  
  /* On contact section - white background */
  .fixed-header.on-contact-section {
    background: #FFFFFF !important;
  }

  .fixed-header.on-contact-section .nav-link-new {
    color: #FF8F9D !important;
  }

  .fixed-header.on-contact-section .nav-link-new:hover {
    text-decoration-color: #FF8F9D !important;
  }
  
  .modal.is-open {
    @apply block;
  }
  
  /* Ensure header is visible and properly sized */
  #page-header {
    min-height: 64px;
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Desktop navigation visibility */
  .desktop-nav {
    display: none;
  }
  
  @media (min-width: 768px) {
    .desktop-nav {
      display: flex !important;
    }
  }
  
  /* New navigation link style - Yellow/Lime like the logo */
  .nav-link-new {
    font-family: 'Jaro', sans-serif !important;
    font-size: 1.75rem !important;
    font-weight: 700 !important;
    color: #D9FD12 !important;
    text-decoration: underline !important;
    text-decoration-color: transparent !important;
    text-underline-offset: 8px !important;
    transition: all 0.2s ease !important;
    letter-spacing: 0.02em !important;
    text-transform: lowercase !important;
  }
  
  .nav-link-new:hover {
    text-decoration-color: #D9FD12 !important;
    color: #D9FD12 !important;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    #page-header {
      min-height: 56px;
    }
  }
</style>
