---
import { Icon } from "astro-icon/components";
import ThemeSwitcher from "~/components/theme-switcher.astro";
import type { NavItem } from "~/types";

const navItems: Array<NavItem> = [
  { title: "Talents", url: "#talents" },
  { title: "Creatives", url: "#creatives" },
  { title: "About Us", url: "#aboutus" },
  { title: "Contact Us", url: "#contact" },
];
---

<header
  id="page-header"
  class="absolute bottom-0 z-20 flex w-full items-center justify-between border-b border-transparent px-4 sm:px-8 py-4 bg-default/10 backdrop-blur-sm"
>
  <a class="flex items-center gap-3 hover:!text-default flex-shrink-0" href="#">
    <h1 class="sr-only">Unides</h1>
    <img src="/unides_yellow.png" alt="Unides Logo" class="h-6 sm:h-8 w-auto" />
  </a>
  
  <!-- Desktop Navigation -->
  <div class="desktop-nav flex-grow justify-center">
    <nav class="flex">
      <ul class="flex items-center gap-4 lg:gap-8">
        {
          navItems.map(({ title, url }) => (
            <li>
              <a class="text-sm lg:text-base font-medium nav-link whitespace-nowrap" href={url}>
                {title}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
  </div>
  
  <!-- Mobile & Desktop Right Section -->
  <div class="flex items-center gap-4 sm:gap-6 flex-shrink-0">
    <!-- Mobile Menu Button -->
    <button
      id="open-nav-button"
      type="button"
      class="md:hidden p-2 rounded-md hover:bg-white/10 transition-colors"
      aria-label="Open navigation menu"
    >
      <Icon name="mdi:menu" class="w-6 h-6" />
    </button>
    
    <!-- Theme Switcher -->
    <ThemeSwitcher />
  </div>
  
  <!-- Mobile Menu Modal -->
  <div id="menu-modal" class="modal hidden fixed inset-0 z-50 md:hidden" aria-hidden="true">
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" id="menu-backdrop"></div>
    <div class="fixed inset-0 bg-default">
      <div class="flex flex-col h-full">
        <!-- Mobile Menu Header -->
        <div class="flex items-center justify-between p-4 border-b border-default/20">
          <img src="/unides_yellow.png" alt="Unides Logo" class="h-6 w-auto" />
          <button
            id="close-nav-button"
            type="button"
            class="p-2 rounded-md hover:bg-default/10 transition-colors"
            aria-label="Close navigation menu"
          >
            <Icon name="mdi:close" class="w-6 h-6" />
          </button>
        </div>
        
        <!-- Mobile Navigation -->
        <nav class="flex-1 px-4 py-8">
          <ul class="space-y-2">
            {
              navItems.map(({ title, url }) => (
                <li>
                  <a 
                    class="block py-4 px-4 text-lg font-medium mobile-nav-link rounded-lg hover:bg-default/10 transition-colors"
                    href={url}
                  >
                    {title}
                  </a>
                </li>
              ))
            }
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

<script>
  const menuModal = document.getElementById('menu-modal');
  const menuBackdrop = document.getElementById('menu-backdrop');
  const openNavButton = document.getElementById('open-nav-button');
  const closeNavButton = document.getElementById('close-nav-button');
  const header = document.getElementById('page-header');
  const page = document.documentElement;

  // Open mobile menu
  const openMenu = () => {
    if (menuModal) {
      menuModal.classList.remove('hidden');
      menuModal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }
  };

  // Close mobile menu
  const closeMenu = () => {
    if (menuModal) {
      menuModal.classList.add('hidden');
      menuModal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = 'auto';
    }
  };

  // Event listeners
  if (openNavButton) {
    openNavButton.addEventListener('click', openMenu);
  }

  if (closeNavButton) {
    closeNavButton.addEventListener('click', closeMenu);
  }

  // Close menu when clicking backdrop
  if (menuBackdrop) {
    menuBackdrop.addEventListener('click', closeMenu);
  }

  // Close menu when clicking a nav link
  if (menuModal) {
    menuModal.addEventListener('click', (event) => {
      if (event.target.matches('.mobile-nav-link')) {
        closeMenu();
      }
    });
  }

  // Handle scroll for fixed header
  if (header) {
    document.addEventListener('scroll', () => {
      const d = page.clientHeight - page.scrollTop - header.offsetHeight;
      header.classList.toggle('fixed-header', d < 0);
    });
  }

  // Close menu on escape key
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && menuModal && !menuModal.classList.contains('hidden')) {
      closeMenu();
    }
  });
</script>

<noscript>
  <style>
    #open-nav-button {
      display: none;
    }
  </style>
</noscript>

<style>
  .fixed-header {
    @apply fixed bottom-auto top-0;
    @apply border-default bg-default text-default;
  }
  
  .modal.is-open {
    @apply block;
  }
  
  /* Ensure header is visible and properly sized */
  #page-header {
    min-height: 64px;
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
  }
  
  /* Desktop navigation visibility */
  .desktop-nav {
    display: none;
  }
  
  @media (min-width: 768px) {
    .desktop-nav {
      display: flex !important;
    }
    
    #page-header .desktop-nav {
      display: flex !important;
      visibility: visible !important;
    }
    
    #page-header .desktop-nav nav {
      display: flex !important;
      visibility: visible !important;
    }
    
    #page-header .desktop-nav nav ul {
      display: flex !important;
      visibility: visible !important;
    }
  }
  
  /* Mobile menu styles */
  .modal {
    transition: all 0.3s ease;
  }
  
  .modal.hidden {
    display: none !important;
  }
  
  .modal:not(.hidden) {
    display: block !important;
  }
  
  /* Desktop navigation styles */
  .nav-link {
    position: relative;
    padding: 0.5rem 1rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    transition: all 0.3s ease;
    border-radius: 6px;
    background: transparent !important;
    box-shadow: none;
    color: inherit !important;
    display: inline-block;
    text-decoration: none;
    overflow: hidden;
  }
  
  /* Slide-in underline effect */
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    height: 2px;
    width: 0;
    background: #fd5d13;
    transition: width 0.3s ease;
  }
  
  .nav-link:hover::after {
    width: 100%;
  }
  
  /* Focus state for accessibility */
  .nav-link:focus {
    outline: 2px solid #fd5d13;
    outline-offset: 2px;
    color: #fd5d13;
    transform: scale(1.05);
    background: rgba(253, 93, 19, 0.1);
  }
  
  .nav-link:focus::after {
    width: 100%;
  }
  
  /* Enhanced hover state */
  .nav-link:hover {
    color: #fd5d13;
    transform: scale(1.05);
    background: rgba(253, 93, 19, 0.05) !important;
    box-shadow: 0 0 15px rgba(253, 93, 19, 0.1);
    animation: subtle-pulse 2s ease-in-out infinite;
  }
  
  @keyframes subtle-pulse {
    0%, 100% { 
      box-shadow: 0 0 15px rgba(253, 93, 19, 0.1); 
    }
    50% { 
      box-shadow: 0 0 20px rgba(253, 93, 19, 0.2); 
    }
  }
  
  /* Mobile navigation styles */
  .mobile-nav-link {
    position: relative;
    transition: all 0.3s ease;
    font-weight: 500;
    display: block;
    text-decoration: none;
  }
  
  .mobile-nav-link:hover {
    color: var(--color-accent, #fd5d13);
    transform: translateX(0.5rem);
    background: rgba(253, 93, 19, 0.1);
  }
  
  .mobile-nav-link:focus {
    outline: 2px solid var(--color-accent, #fd5d13);
    outline-offset: 2px;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    #page-header {
      min-height: 56px;
    }
    
    .nav-link {
      padding: 0.375rem 0.75rem;
      font-size: 0.875rem;
    }
  }
  
  /* Prevent content jump on mobile menu open */
  body.menu-open {
    overflow: hidden;
  }
</style>
